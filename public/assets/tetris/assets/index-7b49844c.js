var Vt=Object.defineProperty;var qt=(t,e,n)=>e in t?Vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(qt(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const P={CANVAS_WIDTH:200,CANVAS_HEIGHT:400,PREVIEW_WIDTH:160,PREVIEW_HEIGHT:80},b={TICK_RATE_MS:200,GRID_WIDTH:10,GRID_HEIGHT:20},$={WIDTH:P.CANVAS_WIDTH/b.GRID_WIDTH,HEIGHT:P.CANVAS_HEIGHT/b.GRID_HEIGHT},F=(t,e,n)=>Array.from({length:t},()=>Array.from({length:e},()=>n)),it=t=>e=>t.reduce((n,r)=>n&&e(r),!0),yt=t=>e=>n=>t.reduce((r,i,o)=>r||i.reduce((u,c,s)=>u||n(t[o][s])(e[o][s]),!1),!1),Ut=t=>e=>n=>t.map((r,i)=>r.map((o,u)=>n(t[i][u])(e[i][u]))),Ft=t=>e=>mt(t).map((n,r)=>({index:r,bool:e(n)})).filter(n=>n.bool)[0].index,jt=t=>e=>{const n=mt(t).map((r,i)=>({index:i,bool:e(r)})).filter(r=>r.bool);return n[n.length-1].index},pt=t=>e=>{const n=t.map((r,i)=>({index:i,bool:e(r)})).filter(r=>r.bool);return n[n.length-1].index},mt=t=>t.map((e,n)=>e.map((r,i)=>t[i][n]));function Kt(t){return t[0].map((e,n)=>t.map(r=>r[n]).reverse())}const E=class{};let p=E;m(p,"m",2147483648),m(p,"a",1103515245),m(p,"c",12345),m(p,"hash",e=>(E.a*e+E.c)%E.m),m(p,"scale",e=>2*e/(E.m-1)-1),m(p,"discrete",e=>n=>r=>Math.floor(r/(E.m-1)*(n-e)+e));const ot=t=>({...t,y:t.y+1}),Yt=t=>({...t,x:t.x-1}),ut=t=>({...t,x:t.x+1}),O=t=>{const e=p.discrete(0)(255),r=p.discrete(1)(8)(p.hash(t)),i=p.hash(t+1),o=p.hash(t+2),u=p.hash(t+3);return Jt(r)(`rgb(${e(i)}, ${e(o)}, ${e(u)})`)},Jt=t=>e=>({x:3,y:-3,matrix:Qt(t)(e)}),Qt=t=>e=>{switch(t){case 1:return[[null,null,null,null],[null,e,e,null],[null,e,e,null],[null,null,null,null]];case 2:return[[null,null,null,null],[null,e,null,null],[null,e,e,e],[null,null,null,null]];case 3:return[[null,null,null,null],[null,null,null,e],[null,e,e,e],[null,null,null,null]];case 4:return[[null,e,null,null],[null,e,null,null],[null,e,null,null],[null,e,null,null]];case 5:return[[null,null,null,null],[null,null,e,e],[null,e,e,null],[null,null,null,null]];case 6:return[[null,null,null,null],[null,e,e,null],[null,null,e,e],[null,null,null,null]];default:return[[null,null,null,null],[null,null,e,null],[null,e,e,e],[null,null,null,null]]}},Xt=t=>e=>t||e,bt=t=>e=>(t&&e)!=null;function V(t){const e=t.matrix.length,n=t.matrix[0].length,r=t.x,i=t.y;return F(b.GRID_HEIGHT,b.GRID_HEIGHT,null).map((u,c)=>u.map((s,l)=>c>=i&&c<i+e&&l>=r&&l<r+n?t.matrix[c-i][l-r]:null))}function C(t){return t.reduce((e,n)=>e||n!=null,!1)}const Zt=t=>{t.setAttribute("visibility","visible"),t.parentNode.appendChild(t)},zt=t=>t.setAttribute("visibility","hidden"),Nt=(t,e,n={})=>{const r=document.createElementNS(t,e);return Object.entries(n).forEach(([i,o])=>r.setAttribute(i,o)),r},te=(t,e)=>e.apply(t),z=t=>e=>{const n=e.x+Ft(e.matrix)(C)<0,r=e.x+jt(e.matrix)(C)>b.GRID_WIDTH-1,i=yt(t.stationaryBlocks)(V(e))(bt),o=e.y+pt(e.matrix)(C)>b.GRID_HEIGHT-1;return n||r||i||o};class ee{constructor(){m(this,"apply",e=>{if(e.gameEnd)return e;const n=Yt(e.currentTetrisPiece);return z(e)(n)?e:{...e,currentTetrisPiece:n}})}}class gt{constructor(){m(this,"apply",e=>{if(e.gameEnd)return e;const n=ut(e.currentTetrisPiece);return z(e)(n)?e:{...e,currentTetrisPiece:ut(e.currentTetrisPiece)}})}}m(gt,"canMoveRight",e=>!0);class ne{constructor(){m(this,"apply",e=>{if(e.gameEnd)return e;const n={...e.currentTetrisPiece,matrix:Kt(e.currentTetrisPiece.matrix)};return z(e)(n)?e:{...e,currentTetrisPiece:n}})}}const B=class{constructor(){}apply(e){if(e.gameEnd)return e;const n={...e,upComingTetrisPiece:B.tetrisPieceBlocked(e)?O(e.seed):e.upComingTetrisPiece,currentTetrisPiece:B.tetrisPieceBlocked(e)?e.upComingTetrisPiece:ot(e.currentTetrisPiece),stationaryBlocks:B.tetrisPieceBlocked(e)?Ut(e.stationaryBlocks)(V(e.currentTetrisPiece))(Xt):e.stationaryBlocks,seed:p.hash(e.seed)},r=n.stationaryBlocks.filter(c=>it(c)(s=>s!=null)).length,i=F(r,b.GRID_WIDTH,null),o={...n,score:n.score+r,highscore:Math.max(n.highscore,n.score+r),stationaryBlocks:r>0?[...i,...n.stationaryBlocks.filter(c=>!it(c)(s=>s!=null))]:n.stationaryBlocks};return{...o,gameEnd:C(o.stationaryBlocks[0])}}};let W=B;m(W,"tetrisPieceBlocked",e=>e.currentTetrisPiece.y+pt(e.currentTetrisPiece.matrix)(C)==b.GRID_HEIGHT-1||yt(e.stationaryBlocks)(V(ot(e.currentTetrisPiece)))(bt));class re{constructor(){m(this,"apply",e=>({...e,currentTetrisPiece:O(e.seed),upComingTetrisPiece:O(e.seed+1),stationaryBlocks:F(b.GRID_HEIGHT,b.GRID_WIDTH,null),level:1,score:0,gameEnd:!1}))}}const ct=t=>{Array.from(t.children).filter(e=>e.classList.contains("block")).forEach(e=>t.removeChild(e))},lt=t=>e=>{e.forEach((n,r)=>n.forEach((i,o)=>ie(t)(i)(r)(o)))},ie=t=>e=>n=>r=>{if(e!=null){const o=function(){const u=Nt(t.namespaceURI,"rect");return t.appendChild(u),u}();o.setAttribute("height",`${$.HEIGHT}`),o.setAttribute("width",`${$.WIDTH}`),o.setAttribute("x",`${$.WIDTH*r}`),o.setAttribute("y",`${$.HEIGHT*n}`),o.setAttribute("style",`fill: ${e}`),o.setAttribute("class","block")}};function oe(){return function(t){const e=document.querySelector("#svgCanvas"),n=document.querySelector("#svgPreview"),r=document.querySelector("#gameOver");document.querySelector("#main"),e.setAttribute("height",`${P.CANVAS_HEIGHT}`),e.setAttribute("width",`${P.CANVAS_WIDTH}`),n.setAttribute("height",`${P.PREVIEW_HEIGHT}`),n.setAttribute("width",`${P.PREVIEW_WIDTH}`);const i=document.querySelector("#levelText"),o=document.querySelector("#scoreText"),u=document.querySelector("#highScoreText");i.textContent=t.level.toString(),o.textContent=t.score.toString(),u.textContent=t.highscore.toString(),ct(e),ct(n);const c=lt(e);c(t.stationaryBlocks),c(V(t.currentTetrisPiece)),lt(n)(t.upComingTetrisPiece.matrix),t.gameEnd?Zt(r):zt(r)}}var J=function(t,e){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},J(t,e)};function k(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");J(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function ue(t,e,n,r){function i(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function c(a){try{l(r.next(a))}catch(v){u(v)}}function s(a){try{l(r.throw(a))}catch(v){u(v)}}function l(a){a.done?o(a.value):i(a.value).then(c,s)}l((r=r.apply(t,e||[])).next())})}function wt(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,u;return u={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function c(l){return function(a){return s([l,a])}}function s(l){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(a){l=[6,a],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function G(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function S(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],u;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){u={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(u)throw u.error}}return o}function x(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function H(t){return this instanceof H?(this.v=t,this):new H(t)}function ce(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i={},u("next"),u("throw"),u("return"),i[Symbol.asyncIterator]=function(){return this},i;function u(h){r[h]&&(i[h]=function(y){return new Promise(function(w,d){o.push([h,y,w,d])>1||c(h,y)})})}function c(h,y){try{s(r[h](y))}catch(w){v(o[0][3],w)}}function s(h){h.value instanceof H?Promise.resolve(h.value.v).then(l,a):v(o[0][2],h)}function l(h){c("next",h)}function a(h){c("throw",h)}function v(h,y){h(y),o.shift(),o.length&&c(o[0][0],o[0][1])}}function le(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof G=="function"?G(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(u){return new Promise(function(c,s){u=t[o](u),i(c,s,u.done,u.value)})}}function i(o,u,c,s){Promise.resolve(s).then(function(l){o({value:l,done:c})},u)}}function f(t){return typeof t=="function"}function se(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var K=se(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Q(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var j=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,o;if(!this.closed){this.closed=!0;var u=this._parentage;if(u)if(this._parentage=null,Array.isArray(u))try{for(var c=G(u),s=c.next();!s.done;s=c.next()){var l=s.value;l.remove(this)}}catch(d){e={error:d}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}else u.remove(this);var a=this.initialTeardown;if(f(a))try{a()}catch(d){o=d instanceof K?d.errors:[d]}var v=this._finalizers;if(v){this._finalizers=null;try{for(var h=G(v),y=h.next();!y.done;y=h.next()){var w=y.value;try{st(w)}catch(d){o=o??[],d instanceof K?o=x(x([],S(o)),S(d.errors)):o.push(d)}}}catch(d){r={error:d}}finally{try{y&&!y.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}if(o)throw new K(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)st(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Q(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Q(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();j.EMPTY;function It(t){return t instanceof j||t&&"closed"in t&&f(t.remove)&&f(t.add)&&f(t.unsubscribe)}function st(t){f(t)?t():t.unsubscribe()}var St={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},X={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=X.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,x([t,e],S(n))):setTimeout.apply(void 0,x([t,e],S(n)))},clearTimeout:function(t){var e=X.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Tt(t){X.setTimeout(function(){throw t})}function at(){}function ae(t){t()}var N=function(t){k(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,It(n)&&n.add(r)):r.destination=ve,r}return e.create=function(n,r,i){return new Z(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(j),fe=Function.prototype.bind;function Y(t,e){return fe.call(t,e)}var he=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){M(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){M(r)}else M(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){M(n)}},t}(),Z=function(t){k(e,t);function e(n,r,i){var o=t.call(this)||this,u;if(f(n)||!n)u={next:n??void 0,error:r??void 0,complete:i??void 0};else{var c;o&&St.useDeprecatedNextContext?(c=Object.create(n),c.unsubscribe=function(){return o.unsubscribe()},u={next:n.next&&Y(n.next,c),error:n.error&&Y(n.error,c),complete:n.complete&&Y(n.complete,c)}):u=n}return o.destination=new he(u),o}return e}(N);function M(t){Tt(t)}function de(t){throw t}var ve={closed:!0,next:at,error:de,complete:at},tt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Et(t){return t}function ye(t){return t.length===0?Et:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var g=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,o=me(e)?e:new Z(e,n,r);return ae(function(){var u=i,c=u.operator,s=u.source;o.add(c?c.call(o,s):s?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=ft(n),new n(function(i,o){var u=new Z({next:function(c){try{e(c)}catch(s){o(s),u.unsubscribe()}},error:o,complete:i});r.subscribe(u)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[tt]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return ye(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=ft(e),new e(function(r,i){var o;n.subscribe(function(u){return o=u},function(u){return i(u)},function(){return r(o)})})},t.create=function(e){return new t(e)},t}();function ft(t){var e;return(e=t??St.Promise)!==null&&e!==void 0?e:Promise}function pe(t){return t&&f(t.next)&&f(t.error)&&f(t.complete)}function me(t){return t&&t instanceof N||pe(t)&&It(t)}function be(t){return f(t==null?void 0:t.lift)}function R(t){return function(e){if(be(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function _(t,e,n,r,i){return new ge(t,e,n,r,i)}var ge=function(t){k(e,t);function e(n,r,i,o,u,c){var s=t.call(this,n)||this;return s.onFinalize=u,s.shouldUnsubscribe=c,s._next=r?function(l){try{r(l)}catch(a){n.error(a)}}:t.prototype._next,s._error=o?function(l){try{o(l)}catch(a){n.error(a)}finally{this.unsubscribe()}}:t.prototype._error,s._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,s}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(N),xt={now:function(){return(xt.delegate||Date).now()},delegate:void 0},we=function(t){k(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(j),q={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=q.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,x([t,e],S(n))):setInterval.apply(void 0,x([t,e],S(n)))},clearInterval:function(t){var e=q.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Ie=function(t){k(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var o=this.id,u=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(u,o,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(u,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),q.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&q.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,o;try{this.work(n)}catch(u){i=!0,o=u||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Q(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(we),ht=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=xt.now,t}(),Se=function(t){k(e,t);function e(n,r){r===void 0&&(r=ht.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(ht),At=new Se(Ie),Te=At,Ee=new g(function(t){return t.complete()});function Pt(t){return t&&f(t.schedule)}function Ht(t){return t[t.length-1]}function xe(t){return Pt(Ht(t))?t.pop():void 0}function Ae(t,e){return typeof Ht(t)=="number"?t.pop():e}var et=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function _t(t){return f(t==null?void 0:t.then)}function kt(t){return f(t[tt])}function Rt(t){return Symbol.asyncIterator&&f(t==null?void 0:t[Symbol.asyncIterator])}function Dt(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Pe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ct=Pe();function Bt(t){return f(t==null?void 0:t[Ct])}function Ot(t){return ce(this,arguments,function(){var n,r,i,o;return wt(this,function(u){switch(u.label){case 0:n=t.getReader(),u.label=1;case 1:u.trys.push([1,,9,10]),u.label=2;case 2:return[4,H(n.read())];case 3:return r=u.sent(),i=r.value,o=r.done,o?[4,H(void 0)]:[3,5];case 4:return[2,u.sent()];case 5:return[4,H(i)];case 6:return[4,u.sent()];case 7:return u.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Gt(t){return f(t==null?void 0:t.getReader)}function A(t){if(t instanceof g)return t;if(t!=null){if(kt(t))return He(t);if(et(t))return _e(t);if(_t(t))return ke(t);if(Rt(t))return Lt(t);if(Bt(t))return Re(t);if(Gt(t))return De(t)}throw Dt(t)}function He(t){return new g(function(e){var n=t[tt]();if(f(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _e(t){return new g(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function ke(t){return new g(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Tt)})}function Re(t){return new g(function(e){var n,r;try{for(var i=G(t),o=i.next();!o.done;o=i.next()){var u=o.value;if(e.next(u),e.closed)return}}catch(c){n={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Lt(t){return new g(function(e){Ce(t,e).catch(function(n){return e.error(n)})})}function De(t){return Lt(Ot(t))}function Ce(t,e){var n,r,i,o;return ue(this,void 0,void 0,function(){var u,c;return wt(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=le(t),s.label=1;case 1:return[4,n.next()];case 2:if(r=s.sent(),!!r.done)return[3,4];if(u=r.value,e.next(u),e.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=s.sent(),i={error:c},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function I(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(o),!i)return o}function $t(t,e){return e===void 0&&(e=0),R(function(n,r){n.subscribe(_(r,function(i){return I(r,t,function(){return r.next(i)},e)},function(){return I(r,t,function(){return r.complete()},e)},function(i){return I(r,t,function(){return r.error(i)},e)}))})}function Mt(t,e){return e===void 0&&(e=0),R(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Be(t,e){return A(t).pipe(Mt(e),$t(e))}function Oe(t,e){return A(t).pipe(Mt(e),$t(e))}function Ge(t,e){return new g(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Le(t,e){return new g(function(n){var r;return I(n,e,function(){r=t[Ct](),I(n,e,function(){var i,o,u;try{i=r.next(),o=i.value,u=i.done}catch(c){n.error(c);return}u?n.complete():n.next(o)},0,!0)}),function(){return f(r==null?void 0:r.return)&&r.return()}})}function Wt(t,e){if(!t)throw new Error("Iterable cannot be null");return new g(function(n){I(n,e,function(){var r=t[Symbol.asyncIterator]();I(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function $e(t,e){return Wt(Ot(t),e)}function Me(t,e){if(t!=null){if(kt(t))return Be(t,e);if(et(t))return Ge(t,e);if(_t(t))return Oe(t,e);if(Rt(t))return Wt(t,e);if(Bt(t))return Le(t,e);if(Gt(t))return $e(t,e)}throw Dt(t)}function We(t,e){return e?Me(t,e):A(t)}function Ve(t){return t instanceof Date&&!isNaN(t)}function T(t,e){return R(function(n,r){var i=0;n.subscribe(_(r,function(o){r.next(t.call(e,o,i++))}))})}var qe=Array.isArray;function Ue(t,e){return qe(e)?t.apply(void 0,x([],S(e))):t(e)}function Fe(t){return T(function(e){return Ue(t,e)})}function je(t,e,n,r,i,o,u,c){var s=[],l=0,a=0,v=!1,h=function(){v&&!s.length&&!l&&e.complete()},y=function(d){return l<r?w(d):s.push(d)},w=function(d){o&&e.next(d),l++;var rt=!1;A(n(d,a++)).subscribe(_(e,function(D){i==null||i(D),o?y(D):e.next(D)},function(){rt=!0},void 0,function(){if(rt)try{l--;for(var D=function(){var L=s.shift();u?I(e,u,function(){return w(L)}):w(L)};s.length&&l<r;)D();h()}catch(L){e.error(L)}}))};return t.subscribe(_(e,y,function(){v=!0,h()})),function(){c==null||c()}}function nt(t,e,n){return n===void 0&&(n=1/0),f(e)?nt(function(r,i){return T(function(o,u){return e(r,o,i,u)})(A(t(r,i)))},n):(typeof e=="number"&&(n=e),R(function(r,i){return je(r,i,t,n)}))}function Ke(t){return t===void 0&&(t=1/0),nt(Et,t)}var Ye=["addListener","removeListener"],Je=["addEventListener","removeEventListener"],Qe=["on","off"];function U(t,e,n,r){if(f(n)&&(r=n,n=void 0),r)return U(t,e,n).pipe(Fe(r));var i=S(ze(t)?Je.map(function(c){return function(s){return t[c](e,s,n)}}):Xe(t)?Ye.map(dt(t,e)):Ze(t)?Qe.map(dt(t,e)):[],2),o=i[0],u=i[1];if(!o&&et(t))return nt(function(c){return U(c,e,n)})(A(t));if(!o)throw new TypeError("Invalid event target");return new g(function(c){var s=function(){for(var l=[],a=0;a<arguments.length;a++)l[a]=arguments[a];return c.next(1<l.length?l:l[0])};return o(s),function(){return u(s)}})}function dt(t,e){return function(n){return function(r){return t[n](e,r)}}}function Xe(t){return f(t.addListener)&&f(t.removeListener)}function Ze(t){return f(t.on)&&f(t.off)}function ze(t){return f(t.addEventListener)&&f(t.removeEventListener)}function Ne(t,e,n){t===void 0&&(t=0),n===void 0&&(n=Te);var r=-1;return e!=null&&(Pt(e)?n=e:r=e),new g(function(i){var o=Ve(t)?+t-n.now():t;o<0&&(o=0);var u=0;return n.schedule(function(){i.closed||(i.next(u++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function tn(t,e){return t===void 0&&(t=0),e===void 0&&(e=At),t<0&&(t=0),Ne(t,t,e)}function en(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=xe(t),r=Ae(t,1/0),i=t;return i.length?i.length===1?A(i[0]):Ke(r)(We(i,n)):Ee}function vt(t,e){return R(function(n,r){var i=0;n.subscribe(_(r,function(o){return t.call(e,o,i++)&&r.next(o)}))})}function nn(t,e,n,r,i){return function(o,u){var c=n,s=e,l=0;o.subscribe(_(u,function(a){var v=l++;s=c?t(s,a,v):(c=!0,a),r&&u.next(s)},i&&function(){c&&u.next(s),u.complete()}))}}function rn(t,e){return R(nn(t,e,arguments.length>=2,!0))}const on={upComingTetrisPiece:O(1),currentTetrisPiece:O(2),stationaryBlocks:F(b.GRID_HEIGHT,b.GRID_WIDTH,null),level:1,score:0,highscore:0,gameEnd:!1,seed:3};function un(){const t=U(document,"keypress"),e=a=>t.pipe(vt(({code:v})=>v===a),vt(({repeat:v})=>!v)),n=e("KeyA").pipe(T(a=>new ee)),r=e("KeyD").pipe(T(a=>new gt)),i=e("KeyS").pipe(T(a=>new ne)),o=tn(b.TICK_RATE_MS).pipe(T(a=>new W)),u=document.getElementById("restart-button"),c=U(u,"click").pipe(T(a=>new re));en(o,n,r,i,c).pipe(rn(te,on)).subscribe(oe())}typeof window<"u"&&(window.onload=()=>{un()});
